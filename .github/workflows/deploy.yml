name: Deploy Backend (Docker)

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: [self-hosted, backend]

    steps:
      - name: Pull latest backend code on server
        run: |
          cd /opt/KafkaManager-docker/backend
          git pull origin main

      - name: Build backend Docker image
        run: |
          cd /opt/KafkaManager-docker
          docker compose build backend

      - name: Restart backend container
        run: |
          cd /opt/KafkaManager-docker
          docker compose up -d backend

      - name: Verify backend container
        run: docker ps | grep kafkamanager_backend
